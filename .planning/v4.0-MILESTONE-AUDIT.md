---
milestone: v4.0
audited: 2026-02-17
status: tech_debt
scores:
  requirements: 22/22
  phases: 7/7
  integration: 19/19
  flows: 10/10
tech_debt:
  - phase: 05-infrastructure-monitoring
    items:
      - "MCPBridge never instantiated in index.js — MCP capabilities not in AI brain context"
      - "HealthMonitor state.logHealthRestart() never called — restart history always empty"
  - phase: 03-foundation-hardening
    items:
      - "NL handler JSON-strip pattern doesn't match actual context text — wastes ~2000 tokens"
      - "NL handler prompt promises file reading but maxTurns=1 prevents tool use"
---

# v4.0 Milestone Audit — Project Orchestrator

**Milestone:** v4.0 Autonomous Agent with External Integrations
**Audited:** 2026-02-17 (re-audit after gap closure)
**Status:** tech_debt (0 critical, 4 non-critical)

## Requirements Coverage

All 22 requirements satisfied. No degraded functionality.

| Category | Requirements | Status |
|----------|-------------|--------|
| Foundation Hardening | FOUND-01 — FOUND-06 | 6/6 Complete |
| Session Intelligence | SESS-01 — SESS-04 | 4/4 Complete |
| Infrastructure Monitoring | INFRA-01 — INFRA-03 | 3/3 Complete |
| Revenue & Autonomy | REV-01 — REV-05 | 5/5 Complete |
| Personal Assistant | PA-01 — PA-04 | 4/4 Complete |

## Phase Verification

| Phase | Status | Score |
|-------|--------|-------|
| 01 AI Brain Foundation | Passed | 17/17 |
| 02 Autonomous Execution | Passed | 21/21 |
| 03 Foundation Hardening | Passed | 12/12 |
| 04 Session Intelligence | Passed | 4/4 |
| 05 Infrastructure Monitoring | Passed | 23/23 |
| 06 Revenue & Autonomy | Passed | 5/5 |
| 07 Personal Assistant | Passed (after TDZ fix) | 4/4 |

## Critical Gaps — ALL FIXED

All 3 critical gaps from the initial audit were fixed in commit `aa18b12`:

### 1. `ai level` command — FIXED

**Fix:** Added `ai` subcommand interception block in `commands.js route()` (lines 57-68) BEFORE the NL fallthrough. `ai level`, `ai status`, `ai think`, `ai explain`, `ai help` all routed correctly now.

### 2. TrustTracker.resetPromotionFlag — FIXED

**Fix:** `trustTracker` passed to CommandRouter via deps (index.js line 128). `_handleAiLevel()` calls `this.trustTracker.resetPromotionFlag()` after `state.setAutonomyLevel()` (commands.js line 485). Null-guarded.

### 3. Evening digest commits — FIXED

**Fix:** Changed `gitTracker.getProgress(projectDir, 24)` to `gitTracker.getProgress(projectDir, '24 hours ago')` in `sendEveningDigest()` (index.js line 192). Valid git `--since` value.

## Non-Critical Tech Debt (4 items, deferred to v5.0)

### 1. MCPBridge never instantiated in index.js

MCPBridge class exists with `queryMCP()` and circuit breakers, but is never imported or instantiated in `index.js`. AI brain context never includes MCP capability information. Session resume prompts reference `MCPBridge.KNOWN_SERVERS` transiently. Forward-compatible design per Phase 05 verification.

### 2. NL handler JSON-strip pattern mismatch

`commands.js` searches for `'Respond with a JSON object'` but actual context contains `'Response format is enforced by JSON schema'`. Strip never fires, sending ~2000 extra tokens of conflicting JSON schema instructions to the NL model.

### 3. NL handler maxTurns=1 prevents file reading

Prompt says "You have full permission to read any file" but `maxTurns: 1` prevents any tool calls (requires 3 turns minimum). Claims file-reading ability it cannot exercise.

### 4. HealthMonitor restart logging not wired

`state.logHealthRestart()` exists and is tested, but `health-monitor.js _restartService()` never calls it. Restart history in state.json is always empty. Auto-restart safety (budget tracking) still works via in-memory array.

## Shared SQLite Integration

All 5 modules sharing `orchestrator.db` are properly integrated:
- No table name conflicts: `revenue_snapshots`, `trust_summary`, `reminders`, `conversations`, `session_evaluations`
- All use WAL mode
- All lazy-init correctly
- All `close()` called on shutdown

## Cross-Phase Integration (19/19)

All 6 cross-phase integration points verified:
1. Phase 03 exec.js semaphore → used by all downstream AI callers (5 consumers)
2. Phase 04 SessionEvaluator → Phase 07 SessionLearner (dual-write confirmed)
3. Phase 05 HealthMonitor → context assembler (health section in AI brain)
4. Phase 06 TrustTracker → commands.js (autonomy level change + promotion reset)
5. Phase 07 ConversationStore → NL handler (conversation context in prompts)
6. All SQLite modules sharing orchestrator.db (5 tables, no conflicts)

## E2E Flow Status

| Flow | Status |
|------|--------|
| SMS → NL → AI → reminder → reply | Working |
| SMS → `ai level` → autonomy change | Working (FIXED) |
| Scan → AI think → decision → session | Working |
| Session stop → eval → learning → context | Working |
| Health check → failure → alert | Working |
| Health check → auto-restart → verify | Working |
| Revenue collect → context → AI | Working |
| Trust update → promotion → SMS | Working (FIXED) |
| Evening digest → commit summary | Working (FIXED) |
| Session → resume prompt + MCP + eval | Working |

## Test Suite

185 tests passing across 14 test files, 0 failures.

## Conclusion

v4.0 milestone is complete. All 22 requirements satisfied, all 7 phases verified, all 10 E2E flows working. 4 non-critical tech debt items deferred to v5.0.
